<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genetic Algorithm Visualization</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .step-container {
            padding: 30px;
        }
        
        .step {
            margin-bottom: 40px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .step:hover {
            border-color: #4facfe;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.2);
        }
        
        .step-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .step-content {
            padding: 25px;
        }
        
        .navigation {
            text-align: center;
            margin-top: 30px;
        }
        
        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß¨ Genetic Algorithm Visualization</h1>
            <p>Step-by-step breakdown of how the genetic algorithm works for meal planning</p>
        </div>
        
        <div class="step-container">
            <!-- Step 1: User Inputs and Target Calculation -->
            <div class="step">
                <div class="step-header">
                    Step 1: User Inputs and Target Calculation
                </div>
                <div class="step-content">
                    <h4>üìä How We Calculate Your Daily Targets:</h4>
                    
                    <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üî¢ BMR (Base Metabolic Rate) Formula:</h5>
                        <p><strong>For Males:</strong> BMR = 10 √ó weight(kg) + 6.25 √ó height(cm) - 5 √ó age + 5</p>
                        <p><strong>For Females:</strong> BMR = 10 √ó weight(kg) + 6.25 √ó height(cm) - 5 √ó age - 161</p>
                        <p><em>Example: 10 √ó 70 + 6.25 √ó 175 - 5 √ó 25 + 5 = 1,675 calories</em></p>
                    </div>
                    
                    <div style="background: #f0fff0; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>‚ö° TDEE (Total Daily Energy Expenditure):</h5>
                        <p><strong>TDEE = BMR √ó Activity Level</strong></p>
                        <ul>
                            <li><strong>Sedentary:</strong> BMR √ó 1.53 (office work, no exercise)</li>
                            <li><strong>Moderate:</strong> BMR √ó 1.80 (light exercise 3-5 days/week)</li>
                            <li><strong>Heavy:</strong> BMR √ó 2.30 (heavy exercise 6-7 days/week)</li>
                        </ul>
                        <p><em>Example: 1,675 √ó 1.80 = 3,015 calories per day</em></p>
                    </div>
                    
                    <div style="background: #fff8f0; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üçñ Macro Distribution Formula:</h5>
                        <p><strong>Protein:</strong> Max(0.83 √ó weight, 15% of calories √∑ 4) grams</p>
                        <p><strong>Carbs:</strong> 60% of calories √∑ 4 grams</p>
                        <p><strong>Fat:</strong> 25% of calories √∑ 9 grams</p>
                        <p><em>Example: Protein = Max(58g, 113g) = 113g</em></p>
                    </div>
                    
                    <div style="background: #f8f0ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üçΩÔ∏è How Meal Split Works:</h5>
                        <p><strong>User sets percentages:</strong> Breakfast {{ meal_split.breakfast }}%, Lunch {{ meal_split.lunch }}%, Dinner {{ meal_split.dinner }}%</p>
                        <p><strong>Calorie targets per meal:</strong></p>
                        <ul>
                            <li>Breakfast: {{ targets.TDEE }} √ó {{ meal_split.breakfast }}% = {{ (targets.TDEE * meal_split.breakfast / 100)|round }} calories</li>
                            <li>Lunch: {{ targets.TDEE }} √ó {{ meal_split.lunch }}% = {{ (targets.TDEE * meal_split.lunch / 100)|round }} calories</li>
                            <li>Dinner: {{ targets.TDEE }} √ó {{ meal_split.dinner }}% = {{ (targets.TDEE * meal_split.dinner / 100)|round }} calories</li>
                        </ul>
                    </div>
                    
                    <div style="background: #ffe0e0; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üéØ Macro Focus ({{ macro_focus }}) Weights:</h5>
                        <p><strong>How we prioritize macros in scoring:</strong></p>
                        <ul>
                            <li><strong>Protein Focus:</strong> Protein weight = 2, Others = 1</li>
                            <li><strong>Carbs Focus:</strong> Carbs weight = 2, Others = 1</li>
                            <li><strong>Fat Focus:</strong> Fat weight = 2, Others = 1</li>
                        </ul>
                        <p><em>Higher weight = more important in meal selection</em></p>
                    </div>
                    
                    <h4>üìã Your Calculated Targets:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #4facfe;">{{ targets.TDEE }}</div>
                            <div style="font-size: 0.9em; color: #666;">Daily Calories</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #4facfe;">{{ targets.Protein }}g</div>
                            <div style="font-size: 0.9em; color: #666;">Protein</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #4facfe;">{{ targets.Carbs }}g</div>
                            <div style="font-size: 0.9em; color: #666;">Carbs</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #4facfe;">{{ targets.Fat }}g</div>
                            <div style="font-size: 0.9em; color: #666;">Fat</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Fitness Scoring -->
            <div class="step">
                <div class="step-header">
                    Step 2: Fitness Scoring - The Heart of the Algorithm
                </div>
                <div class="step-content">
                    <h4>üßÆ How We Score Each Meal Plan (Simple Explanation):</h4>
                    
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üìê Main Scoring Formula:</h5>
                        <p><strong>Fitness Score = 5.0 √ó Calorie Score + Macro Scores + Meal Split Bonus</strong></p>
                        <p><em>Higher score = better meal plan (closer to your targets)</em></p>
                    </div>
                    
                    <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üéØ 1. Calorie Scoring (Most Important - Weight: 5.0):</h5>
                        <p><strong>How close are total calories to your TDEE target?</strong></p>
                        <ul>
                            <li><strong>Perfect (‚â§5% off):</strong> Score = 1.0 ‚Üí Contributes 5.0 points</li>
                            <li><strong>Good (‚â§10% off):</strong> Score = 0.5 ‚Üí Contributes 2.5 points</li>
                            <li><strong>Okay (‚â§15% off):</strong> Score = 0.2 ‚Üí Contributes 1.0 points</li>
                            <li><strong>Poor (>15% off):</strong> Score = 0.0 ‚Üí Contributes 0.0 points</li>
                        </ul>
                        <p><em>Example: If target is 2000 cal and plan has 1950 cal ‚Üí 2.5% off ‚Üí Perfect score!</em></p>
                    </div>
                    
                    <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üçñ 2. Macro Scoring (Weight: 0.5 each √ó Macro Focus):</h5>
                        <p><strong>Formula for each macro:</strong></p>
                        <p>Macro Score = Max(0, 1 - |Actual - Target| / Target) √ó Macro Weight √ó 0.5</p>
                        
                        <h6>Macro Focus Weights:</h6>
                        <ul>
                            <li><strong>Protein Focus:</strong> Protein = 2.0, Carbs = 1.0, Fat = 1.0</li>
                            <li><strong>Carbs Focus:</strong> Protein = 1.0, Carbs = 2.0, Fat = 1.0</li>
                            <li><strong>Fat Focus:</strong> Protein = 1.0, Carbs = 1.0, Fat = 2.0</li>
                        </ul>
                        
                        <p><em>Example: Target protein = 100g, Actual = 90g, Focus = Protein</em></p>
                        <p><em>Score = (1 - |90-100|/100) √ó 2.0 √ó 0.5 = 0.9 √ó 2.0 √ó 0.5 = 0.9 points</em></p>
                    </div>
                    
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üçΩÔ∏è 3. Meal Split Bonus (Weight: 1.0):</h5>
                        <p><strong>How well does the plan follow your meal calorie distribution?</strong></p>
                        <p>Bonus = Max(0, 1 - (Breakfast_diff + Lunch_diff + Dinner_diff) / 60)</p>
                        
                        <p><em>Example: You want 25% breakfast, but plan has 30%</em></p>
                        <p><em>Difference = |30% - 25%| = 5%</em></p>
                        <p><em>If total differences = 15%, Bonus = 1 - 15/60 = 0.75 points</em></p>
                    </div>
                </div>
            </div>

            <!-- Step 3: Available Meal Options -->
            <div class="step">
                <div class="step-header">
                    Step 3: Available Meal Options (Top 10 each)
                </div>
                <div class="step-content">
                    <h4>üç≥ Breakfast Options:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                        {% for meal in bfast_combos %}
                        <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; text-align: center;">
                            <h5 style="margin: 0 0 10px 0; color: #333;">{{ meal.name }}</h5>
                            <div style="font-weight: bold; color: #4facfe; font-size: 1.2em;">{{ meal.calories }} cal</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">P: {{ meal.protein }}g | C: {{ meal.carbs }}g | F: {{ meal.fat }}g</div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <h4>üçΩÔ∏è Lunch Options:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                        {% for meal in lunch_combos %}
                        <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; text-align: center;">
                            <h5 style="margin: 0 0 10px 0; color: #333;">{{ meal.name }}</h5>
                            <div style="font-weight: bold; color: #4facfe; font-size: 1.2em;">{{ meal.calories }} cal</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">P: {{ meal.protein }}g | C: {{ meal.carbs }}g | F: {{ meal.fat }}g</div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <h4>üçñ Dinner Options:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                        {% for meal in dinner_combos %}
                        <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; text-align: center;">
                            <h5 style="margin: 0 0 10px 0; color: #333;">{{ meal.name }}</h5>
                            <div style="font-weight: bold; color: #4facfe; font-size: 1.2em;">{{ meal.calories }} cal</div>
                            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">P: {{ meal.protein }}g | C: {{ meal.carbs }}g | F: {{ meal.fat }}g</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Step 4: Generated Plans -->
            <div class="step">
                <div class="step-header">
                    Step 4: Generated Meal Plans (20 Random Examples)
                </div>
                <div class="step-content">
                    <h4>üé≤ Sample Plans Generated by Algorithm:</h4>
                    <p><em>These are examples of the meal combinations the genetic algorithm would evaluate and optimize.</em></p>
                    
                    <div id="generated-plans" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin: 20px 0;">
                        <!-- Plans will be populated by JavaScript -->
                    </div>
                    
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üìä Total Possible Combinations:</h5>
                        <p><strong>10 √ó 10 √ó 10 = 1,000 possible meal plans</strong></p>
                        <p>The genetic algorithm intelligently searches through these combinations to find the best 20 plans that match your nutritional targets!</p>
                    </div>
                </div>
            </div>

            <!-- Step 5: Genetic Algorithm Process -->
            <div class="step">
                <div class="step-header">
                    Step 5: Genetic Algorithm Evolution Process
                </div>
                <div class="step-content">
                    <h4>üîÑ The Complete Evolution Process:</h4>
                    
                    <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üìà What Happens Each Generation:</h5>
                        <ol>
                            <li><strong>Score all 100 plans</strong> using our fitness formula</li>
                            <li><strong>Select top 20 as elite</strong> (survive unchanged)</li>
                            <li><strong>Select top 70 as breeders</strong> (can reproduce)</li>
                            <li><strong>Create 80 new plans</strong> through crossover</li>
                            <li><strong>Apply 5% mutation rate</strong> to non-elite plans</li>
                            <li><strong>Form next generation</strong> of 100 plans</li>
                        </ol>
                    </div>
                    
                    <div style="background: #fff8f0; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üéØ Why This Works (Simple Explanation):</h5>
                        <ul>
                            <li><strong>Best plans survive:</strong> Elite plans pass good traits to next generation</li>
                            <li><strong>Good plans breed:</strong> Crossover combines successful meal combinations</li>
                            <li><strong>Mutations add variety:</strong> Prevents getting stuck with similar plans</li>
                            <li><strong>Bad plans disappear:</strong> Low-scoring plans are naturally eliminated</li>
                        </ul>
                        <p><em>Like natural evolution, but for meal plans!</em></p>
                    </div>
                    
                    <div style="background: #f0fff0; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üìä Algorithm Parameters (What We Actually Use):</h5>
                        <ul>
                            <li><strong>Population Size:</strong> 100 plans per generation</li>
                            <li><strong>Generations:</strong> 50 iterations</li>
                            <li><strong>Elite Rate:</strong> Top 20% survive unchanged</li>
                            <li><strong>Breeding Pool:</strong> Top 70% can reproduce</li>
                            <li><strong>Mutation Rate:</strong> 5% of non-elite plans</li>
                            <li><strong>Total Evaluations:</strong> 100 √ó 50 = 5,000 meal plans tested!</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="navigation">
                <a href="/" class="btn">‚Üê Back to Meal Planner</a>
                <a href="/compare" class="btn">Compare Algorithms</a>
            </div>
        </div>
    </div>
    
    <script>
        // Generate example data for visualization
        const bfastCombos = {{ bfast_combos | tojson }};
        const lunchCombos = {{ lunch_combos | tojson }};
        const dinnerCombos = {{ dinner_combos | tojson }};
        const targets = {{ targets | tojson }};
        
        // Generate 20 random meal plans
        function generateSamplePlans() {
            const plans = [];
            const planContainer = document.getElementById('generated-plans');
            
            for (let i = 0; i < 20; i++) {
                const bfast = bfastCombos[Math.floor(Math.random() * bfastCombos.length)];
                const lunch = lunchCombos[Math.floor(Math.random() * lunchCombos.length)];
                const dinner = dinnerCombos[Math.floor(Math.random() * dinnerCombos.length)];
                
                const totalCalories = bfast.calories + lunch.calories + dinner.calories;
                const totalProtein = bfast.protein + lunch.protein + dinner.protein;
                const totalCarbs = bfast.carbs + lunch.carbs + dinner.carbs;
                const totalFat = bfast.fat + lunch.fat + dinner.fat;
                
                // Calculate fitness score (simplified)
                const calorieDev = Math.abs(totalCalories - targets.TDEE) / targets.TDEE;
                const proteinDev = Math.abs(totalProtein - targets.Protein) / targets.Protein;
                const carbsDev = Math.abs(totalCarbs - targets.Carbs) / targets.Carbs;
                const fatDev = Math.abs(totalFat - targets.Fat) / targets.Fat;
                
                const caloriePenalty = calorieDev * 30;
                const macroPenalty = (proteinDev + carbsDev + fatDev) * 20;
                const fitnessScore = Math.max(0, 100 - (caloriePenalty + macroPenalty));
                
                const plan = {
                    id: i + 1,
                    breakfast: bfast,
                    lunch: lunch,
                    dinner: dinner,
                    totalCalories,
                    totalProtein,
                    totalCarbs,
                    totalFat,
                    fitnessScore: fitnessScore.toFixed(1)
                };
                
                plans.push(plan);
            }
            
            // Sort by fitness score
            plans.sort((a, b) => b.fitnessScore - a.fitnessScore);
            
            // Display plans
            plans.forEach((plan, index) => {
                const planDiv = document.createElement('div');
                planDiv.style.cssText = `
                    background: ${index < 5 ? '#d4edda' : '#f8f9fa'};
                    border: 2px solid ${index < 5 ? '#28a745' : '#dee2e6'};
                    border-radius: 10px;
                    padding: 20px;
                    position: relative;
                `;
                
                planDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="margin: 0; color: #333;">Plan ${plan.id} ${index < 5 ? 'üèÜ' : ''}</h4>
                        <div style="background: ${index < 5 ? '#28a745' : '#007BFF'}; color: white; padding: 5px 10px; border-radius: 15px; font-weight: bold;">
                            Score: ${plan.fitnessScore}
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <div style="background: white; padding: 10px; border-radius: 6px; text-align: center;">
                            <div style="font-weight: bold; color: #333; margin-bottom: 5px;">üç≥ Breakfast</div>
                            <div style="font-size: 0.9em; color: #666;">${plan.breakfast.name}</div>
                            <div style="color: #4facfe; font-weight: bold;">${plan.breakfast.calories} cal</div>
                        </div>
                        <div style="background: white; padding: 10px; border-radius: 6px; text-align: center;">
                            <div style="font-weight: bold; color: #333; margin-bottom: 5px;">üçΩÔ∏è Lunch</div>
                            <div style="font-size: 0.9em; color: #666;">${plan.lunch.name}</div>
                            <div style="color: #4facfe; font-weight: bold;">${plan.lunch.calories} cal</div>
                        </div>
                        <div style="background: white; padding: 10px; border-radius: 6px; text-align: center;">
                            <div style="font-weight: bold; color: #333; margin-bottom: 5px;">üçñ Dinner</div>
                            <div style="font-size: 0.9em; color: #666;">${plan.dinner.name}</div>
                            <div style="color: #4facfe; font-weight: bold;">${plan.dinner.calories} cal</div>
                        </div>
                    </div>
                    
                    <div style="background: #e3f2fd; border-radius: 6px; padding: 10px;">
                        <div style="font-size: 1.2em; font-weight: bold; color: #1976d2; text-align: center;">
                            Total: ${plan.totalCalories} calories
                        </div>
                        <div style="font-size: 0.9em; color: #666; margin-top: 5px; text-align: center;">
                            P: ${plan.totalProtein}g | C: ${plan.totalCarbs}g | F: ${plan.totalFat}g
                        </div>
                        <div style="font-size: 0.8em; color: #666; margin-top: 5px; text-align: center;">
                            Accuracy: ${((plan.totalCalories / targets.TDEE) * 100).toFixed(1)}% of target calories
                        </div>
                    </div>
                `;
                
                planContainer.appendChild(planDiv);
            });
        }
        
        // Generate plans when page loads
        document.addEventListener('DOMContentLoaded', function() {
            generateSamplePlans();
        });
    </script>
</body>
</html>
